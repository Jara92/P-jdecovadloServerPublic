@using PujcovadloServer.Business.Enums
@using Syncfusion.EJ2.Grids
@using Newtonsoft.Json
@model Syncfusion.EJ2.DataManager
@inject IStringLocalizer<ItemStatus> StatusLocalizer
@inject PujcovadloServer.Data.PujcovadloServerContext dbContext

@{
    Layout = "_Layout";
    ViewData["Title"] = @Localizer["Items"];

    /*int pageSize = 2;
    int totalPages = 10;
    int pageNumber = 0;

    var items = await dbContext.Item.ToListAsync();*/

    Object filterTemplate = new Object();
    filterTemplate = (new { write = "writeStatus", read = "readStatus" });
}

<ejs-grid id="Grid" allowPaging="true" allowSorting="true" allowFiltering="true">
    <e-data-manager url="@Url.Action("IndexFilter", "Item")" adaptor="UrlAdaptor"></e-data-manager>
    <e-grid-pagesettings pageSizes="new int[] { 2, 5, 10 }"></e-grid-pagesettings>
    <e-grid-aggregates>
        <e-grid-aggregate>
            <e-aggregate-columns>
                <e-aggregate-column field="Id" type="Sum"></e-aggregate-column>
            </e-aggregate-columns>
        </e-grid-aggregate>
    </e-grid-aggregates>
    <e-grid-filterSettings type="Excel"></e-grid-filterSettings>
    <e-grid-columns>
        <e-grid-column field="Id" headerText="ID" textAlign="Center" width="120"></e-grid-column>
        <e-grid-column field="Name" headerText="Name" width="150"></e-grid-column>
        <e-grid-column field="Alias" headerText="Alias" width="130" textAlign="Center"></e-grid-column>
        <e-grid-column field="Status" headerText="Status" width="130" textAlign="Center" filterBarTemplate="filterTemplate"></e-grid-column>
    </e-grid-columns>
</ejs-grid>

<script type="text/javascript">
        function writeStatus(args) {
            //var data = [{ text: "clear", value: "clear" }]
           /* let data = [{ text: "clear", value: "clear" }, { text: "1", value: 1 }, { text: "2", value: 2 }, { text: "3", value: 3 }, { text: "4", value: 4 },
                        { text: "5", value: 5 }, { text: "6", value: 6 }, { text: "7", value: 7 }, { text: "8", value: 8 }, { text: "9", value: 9 }
                        ];*/
            
            let data = JSON.parse(@Html.Raw(JsonConvert.ToString(ViewBag.Statuses)));
            data.unshift({ text: "clear", value: "clear" });
             data = [{ text: "Public", value: "1"}, {text: "Private", value: "2" }];
            
            console.log(data);
            
            let listObj = new ej.dropdowns.DropDownList({
                dataSource: data,
                placeholder: '@Localizer["Select item status"]',
                change: function () { readStatus(args) }
            });
            listObj.appendTo(args.element);
        }
        
        function readStatus(args) {
            let grid = document.getElementById("Grid").ej2_instances[0];
            
            if (args.element.value === "clear") {
                grid.clearFiltering(args.column.field);
                args.element.value = null;
            } else {
                grid.filterByColumn(args.column.field, "equal", (args.element.value));
            }
        }
    </script>