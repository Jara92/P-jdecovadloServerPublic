@using PujcovadloServer.Business.Enums
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model PujcovadloServer.Areas.Admin.Requests.ItemRequest
@inject IStringLocalizer<ItemStatus> StatusLocalizer

@{
    Layout = "_Layout";
    ViewData["Title"] = Localizer["Editing item"].Value + ": " + Model.Name;
}

@section Toolbar{
    <ejs-button id="back" cssClass="e-secondary e-flat me-2" iconCss="bi bi-arrow-left-square-fill" content="@Localizer["Back"].Value"></ejs-button>

    <ejs-button id="save" cssClass="e-primary me-2" iconCss="bi bi-save" content="@Localizer["Save changes"].Value"
                isPrimary="true" form="item-form">
    </ejs-button>

    <script>
        document.getElementById('back').onclick = function () {
            window.location.href='@Url.Action("Index", "Item")';
        };
        
        document.getElementById('save').onclick = function () {
            document.getElementById('item-form').submit();
        };
    </script>
}

<form asp-action="Edit" id="item-form">
    <input type="hidden" asp-for="Id"/>

    <div class="container-fluid">
        <div class="row">
            <div class="col-12 m-2">
                <div class="card card-primary card-outline mb-4">
                    <div class="card-header">
                        <div class="card-title">#@Model.Id @Model.Name</div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12 col-lg-6">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                                <div class="form-group mb-3">
                                    <ejs-textbox ejs-for="Name" id="name" placeholder="@Localizer["Name"].Value"
                                                 floatLabelType="Always">
                                    </ejs-textbox>
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-textbox ejs-for="Alias" id="alias" placeholder="@Localizer["Alias"].Value"
                                                 floatLabelType="Always">
                                    </ejs-textbox>
                                    <span asp-validation-for="Alias" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-dropdownlist id="dlOwnerId" dataSource="@ViewBag.Users" placeholder="@Localizer["Owner"].Value"
                                                      popupHeight="220px" ejs-for="OwnerId" floatLabelType="Always"
                                                      allowFiltering="true" filterType="Contains">
                                        @*TODO: use data manager instead*@
                                        <e-dropdownlist-fields value="Id" text="Name"></e-dropdownlist-fields>
                                    </ejs-dropdownlist>
                                    <span asp-validation-for="OwnerId" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-dropdownlist id="dlStatus" dataSource="@ViewBag.Statuses" placeholder="@Localizer["Status"].Value"
                                                      popupHeight="220px" ejs-for="Status" floatLabelType="Always">
                                        <e-dropdownlist-fields value="Id" text="Name"></e-dropdownlist-fields>
                                    </ejs-dropdownlist>
                                    <span asp-validation-for="Status" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-multiselect id="dlCategories" placeholder="@Localizer["Categories"].Value"
                                                     popupHeight="500px" ejs-for="Categories" floatLabelType="Always"
                                                     allowFiltering="true" ignoreAccent="true" filterType="Contains">
                                        <e-data-manager adaptor="UrlAdaptor" url="@Url.Action("IndexFilter", "ItemCategory")" crossDomain="false"></e-data-manager>
                                        <e-multiselect-fields value="Id" text="Name"></e-multiselect-fields>
                                    </ejs-multiselect>
                                    <span asp-validation-for="Categories" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-12 col-lg-6">
                                <div class="form-group mb-3">
                                    <ejs-textbox ejs-for="Description" id="description" placeholder="@Localizer["Description"].Value"
                                                 floatLabelType="Always" multiline="true">
                                    </ejs-textbox>
                                    <span asp-validation-for="Description" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-textbox ejs-for="Parameters" id="parameters" placeholder="@Localizer["Parameters"].Value"
                                                 floatLabelType="Always" multiline="true">
                                    </ejs-textbox>
                                    <span asp-validation-for="Parameters" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-multiselect id="dlTags" dataSource="@ViewBag.Tags" placeholder="@Localizer["Tags"].Value"
                                                     popupHeight="500px" ejs-for="Tags" floatLabelType="Always"
                                                     allowFiltering="true" ignoreAccent="true" filterType="Contains">
                                        @*TODO: use data manager instead*@
                                        <e-multiselect-fields value="Id" text="Name"></e-multiselect-fields>
                                    </ejs-multiselect>
                                    <span asp-validation-for="Tags" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="card card-primary card-outline mb-4">
                    <div class="card-header">
                        <div class="card-title">@Localizer["Item price"]</div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">

                                <div class="form-group mb-3">
                                    <ejs-numerictextbox id="pricePerDay" ejs-for="PricePerDay" step="1" min="0"
                                                        format="###.## K훾"
                                                        floatLabelType="Always"
                                                        placeholder="@Localizer["Price per day"].Value">
                                    </ejs-numerictextbox>
                                    <span asp-validation-for="PricePerDay" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-numerictextbox id="refundableDeposit" ejs-for="RefundableDeposit" step="1" min="0"
                                                        format="###.## K훾"
                                                        floatLabelType="Always"
                                                        placeholder="@Localizer["Refundable deposit"].Value">
                                    </ejs-numerictextbox>
                                    <span asp-validation-for="RefundableDeposit" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-numerictextbox id="purchasePrice" ejs-for="PurchasePrice" step="1" min="0"
                                                        format="###.## K훾"
                                                        floatLabelType="Always"
                                                        placeholder="@Localizer["Purchase price"].Value">
                                    </ejs-numerictextbox>
                                    <span asp-validation-for="PurchasePrice" class="text-danger"></span>
                                </div>

                                <div class="form-group mb-3">
                                    <ejs-numerictextbox id="sellingPrice" ejs-for="SellingPrice" step="1" min="0"
                                                        format="###.## K훾"
                                                        floatLabelType="Always"
                                                        placeholder="@Localizer["Selling price"].Value">
                                    </ejs-numerictextbox>
                                    <span asp-validation-for="SellingPrice" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-primary card-outline mb-4">
                    <div class="card-header">
                        <div class="card-title">@Localizer["Item dates"]</div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">

                                <div class="form-group mb-3">
                                    <ejs-datetimepicker id="createdAt" ejs-for="CreatedAt" placeholder="@Localizer["Created at"].Value"
                                                        format="d.M.yyyy hh:mm" floatLabelType="Always">
                                    </ejs-datetimepicker>
                                    <span asp-validation-for="CreatedAt" class="text-danger"></span>
                                </div>
                                <div class="form-group mb-3">
                                    <ejs-datetimepicker id="updatedAt" ejs-for="UpdatedAt" placeholder="@Localizer["Updated at"].Value"
                                                        format="d.M.yyyy hh:mm" floatLabelType="Always">
                                    </ejs-datetimepicker>
                                    <span asp-validation-for="UpdatedAt" class="text-danger"></span>
                                </div>
                                <div class="form-group mb-3">
                                    <ejs-datetimepicker id="approvedAt" ejs-for="ApprovedAt" placeholder="@Localizer["Approved at"].Value"
                                                        format="d.M.yyyy hh:mm" floatLabelType="Always">
                                    </ejs-datetimepicker>
                                    <span asp-validation-for="ApprovedAt" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-primary card-outline mb-4">
                    <div class="card-header">
                        <div class="card-title">@Localizer["Item images"]</div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            @foreach (var image in ViewBag.Images)
                            {
                                <div class="col-4">
                                    <a href="@image.Url" target="_blank">
                                        <img src="@image.Url" class="img-fluid img-thumbnail" alt="Item image">
                                    </a>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
}